<html>
<head>
  <title> floss </title>
  <link rel="shortcut icon" href="favicon.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta property="og:url"                content="https://mpaulweeks.github.io/floss/" />
  <meta property="og:type"               content="video.other" />
  <meta property="og:title"              content="floss" />
  <meta property="og:description"        content="dead mem" />
  <meta property="og:image"              content="https://mpaulweeks.github.io/floss/favicon.png" />

  <style type="text/css">
    html, body {
      margin: 0px;
      width: 100%;
      height: 100%;
      text-align: center;
    }
    body, button:hover {
      /* https://codepen.io/nohoid/pen/kIfto */
      animation: rainbow 18s ease infinite;
      background: linear-gradient(124deg, #ff2400, #e81d1d, #e8b71d, #e3e81d, #1de840, #1ddde8, #2b1de8, #dd00f3, #dd00f3);
      background-size: 1800% 1800%;
    }
    @keyframes rainbow {
      0% {
        background-position: 0% 82%;
      }
      50% {
        background-position: 100% 19%;
      }
      100% {
        background-position: 0% 82%;
      }
    }

    #welcome {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);

      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      flex-wrap: nowrap;

      background-color: white;
      border-radius: 20px;
      padding: 10px 50px;
    }

    button {
      cursor: pointer;
      font-size: 20px;
      padding: 5px 15px;
      border: 1px solid black;
      border-radius: 5px;
    }
    p {
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: center;
      flex-wrap: nowrap;
    }
    em {
      font-size: 1.2em;
      font-weight: bold;
      font-style: normal;
    }
    #preview {
      height: 300px;
      width: 300px;
      overflow: hidden;
    }
    .row {
      display: flex;
      flex-direction: row;
      justify-content: flex-start;
      align-items: flex-start;
      flex-wrap: nowrap;
    }
    .cell {
      background-size: 100% 100%;
      background-repeat: repeat;

      flex: 1 0 auto;
      height: auto;

      animation-duration: 2s;
      animation-delay: 0s;
      animation-iteration-count: infinite;
      animation-timing-function: linear;
    }
    .cell:before {
      content: '';
      float: left;
      padding-top: 100%;
      padding-left: 50%; /* i dont understand why this is necessary but it is :( */
    }
    .cell[data-reverse="true"] {
      animation-direction: reverse;
    }

    /* animations */
    .cell[data-animation="vertical"] {
      animation-name: vertical;
      background-size: 100% 50%;
    }
    .cell[data-animation="vertical"]:before {
      padding-top: 200%;
      padding-left: 50%;
    }
    @keyframes vertical {
      from {
        background-position: left 0% top 0%;
      }
      to {
        background-position: left 0% top 100%;
      }
    }
    .cell[data-animation="horizontal"] {
      animation-name: horizontal;
      background-size: 50% 100%;
    }
    .cell[data-animation="horizontal"]:before {
      padding-top: 50%;
      padding-left: 200%;
    }
    @keyframes horizontal {
      from {
        background-position: left 0% top 0%;
      }
      to {
        background-position: left 100% top 0%;
      }
    }
    .cell[data-animation="twirl"] {
      animation-name: twirl;
      animation-duration: 4s;
    }
    @keyframes twirl {
      from {
        transform: rotate(0deg);
      }
      to {
        transform: rotate(359deg);
      }
    }

    /* frame animations */
    .cell[data-frame="0"] {
      background-image: url('frames/a0.png');
    }
    .cell[data-frame="1"] {
      background-image: url('frames/a1.png');
    }
    .cell[data-frame="2"] {
      background-image: url('frames/a2.png');
    }
    .cell[data-frame="3"] {
      background-image: url('frames/a3.png');
    }
    .cell[data-frame="4"] {
      background-image: url('frames/a4.png');
    }
    .cell[data-frame="5"] {
      background-image: url('frames/a5.png');
    }

    /* pillbox */
    .switch {
      margin-left: 1em;
      position: relative;
      display: inline-block;
      width: 60px;
      height: 34px;
    }
    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      -webkit-transition: .4s;
      transition: .4s;
    }
    .slider:before {
      position: absolute;
      content: "";
      height: 26px;
      width: 26px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      -webkit-transition: .4s;
      transition: .4s;
    }
    input:checked + .slider {
      background-color: #2196F3;
    }
    input:focus + .slider {
      box-shadow: 0 0 1px #2196F3;
    }
    input:checked + .slider:before {
      -webkit-transform: translateX(26px);
      -ms-transform: translateX(26px);
      transform: translateX(26px);
    }
    .slider.round {
      border-radius: 34px;
    }
    .slider.round:before {
      border-radius: 50%;
    }
  </style>
</head>
<body>

  <div id="welcome">
    <div id="preview">
      <div class="row">
        <div class="cell" data-frame="0"></div>
      </div>
    </div>
    <p>
      <div>
        press the number keys <em>1-4</em> to change the dance
        <br/>
        press the <em>8</em> and <em>9</em> keys to speed up / slow down
        <br/>
        press the <em>0</em> key to reset the speed
        <br/>
        press the <em>+</em> and <em>-</em> keys to zoom in/out
      </div>
    </p>
    <p>
      play music?
      <label id="toggleMusic" class="switch">
        <input id="musicCheckbox" type="checkbox">
        <span class="slider round"></span>
      </label>
    </p>
    <p>
      <button id="init"> START THE DANCE PARTY </button>
    </p>
  </div>

  <script type="text/javascript">

    function sleep(time) {
      return new Promise((resolve, reject) => {
        setTimeout(resolve, time);
      });
    };

    let target = document.getElementById('preview');
    let rows;
    let cells;
    function resize(number) {
      let body = '';
      for (let r = 0; r < number; r++){
        let row = '';
        for (let c = 0; c < number; c++){
          row += '<div class="cell"></div>';
        }
        body += `
          <div class="row">
            ${row}
          </div>
        `;
      }
      target.innerHTML = body;
      rows = Array.from(document.getElementsByClassName('row'));
      cells = Array.from(document.getElementsByClassName('cell'));
    }
    function increaseSize() {
      resize(Math.max(1, rows.length - 1));
      setDefault();
    }
    function decreaseSize() {
      resize(Math.min(20, rows.length + 1));
      setDefault();
    }

    const frameRateDefault = 435;
    let frameRate = frameRateDefault;
    const factor = 0.6;
    function increaseFrameRate(){
      frameRate = frameRate * factor;
      console.log('floss per second:', ((1000 / frameRate) / 6));
    }
    function decreaseFrameRate(){
      frameRate = frameRate / factor;
      console.log('floss per second:', ((1000 / frameRate) / 6));
    }
    function resetFrameRate(){
      frameRate = frameRateDefault;
    }


    function setDefault() {
      rows.forEach((r, ri) => {
        Array.from(r.children).forEach((c, ci) => {
          c.setAttribute('data-frame', (ri + ci) % 6);
          c.setAttribute('data-animation', '');
          c.setAttribute('data-reverse', false);
        });
      });
    }
    function setVertical() {
      rows.forEach((r, ri) => {
        Array.from(r.children).forEach((c, ci) => {
          c.setAttribute('data-frame', ci % 6);
          c.setAttribute('data-animation', 'vertical');
          c.setAttribute('data-reverse', (ci % 2 === 0));
        });
      });
    }
    function setHorizontal() {
      rows.forEach((r, ri) => {
        Array.from(r.children).forEach((c, ci) => {
          c.setAttribute('data-frame', ri % 6);
          c.setAttribute('data-animation', 'horizontal');
          c.setAttribute('data-reverse', (ri % 2 === 0));
        });
      });
    }
    function setTwirl() {
      rows.forEach((r, ri) => {
        Array.from(r.children).forEach((c, ci) => {
          c.setAttribute('data-frame', (ri + ci) % 6);
          c.setAttribute('data-animation', 'twirl');
          c.setAttribute('data-reverse', ((ri + ci) % 2 === 0));
        });
      });
    }


    document.addEventListener('keydown', evt => {
      // console.log(evt);
      switch (evt.code) {
        case 'Digit1':
        case 'KeyD':
          setDefault();
          break;
        case 'Digit2':
        case 'KeyH':
          setHorizontal();
          break;
        case 'Digit3':
        case 'KeyV':
          setVertical();
          break;
        case 'Digit4':
        case 'KeyT':
          setTwirl();
          break;
        case 'Digit8':
          decreaseFrameRate();
          break;
        case 'Digit9':
          increaseFrameRate();
          break;
        case 'Digit0':
          resetFrameRate();
          break;
        case 'Equal':
          increaseSize();
          break;
        case 'Minus':
          decreaseSize();
          break;
      }
    });

    // setup preview
    let audio;
    resize(1);
    setDefault();
    document.getElementById('toggleMusic').addEventListener('click', () => {
      if (document.getElementById('musicCheckbox').value){
        audio = new Audio('party.mp3');
      } else {
        audio = undefined;
      }
    });

    // setup fullscreen
    document.getElementById('init').addEventListener('click', () => {
      target = document.body;
      resize(5);
      setDefault();
      if (audio) {
        audio.play();
      }
    });

    // start the animation loop
    (async () => {
      while (true) {
        cells.forEach((c, ci) => {
          const currentFrame = parseFloat(c.getAttribute('data-frame'));
          c.setAttribute('data-frame', (currentFrame + 1) % 6);
        });
        await sleep(frameRate);
      }
    })()
  </script>
</body>
</html>
